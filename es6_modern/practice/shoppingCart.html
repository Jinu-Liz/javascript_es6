<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script>
    const go = (...args) => reduce((a, f) => f(a), args);

    const pipe = (f, ...fs) => (...args) => go(f(...args), ...fs);

    const curry = f => (a, ...arg) => arg.length ? f(a, ...arg) : (...arg) => f(a, ...arg);

    const map = curry((f, iter) => {
      let res = [];
      for (const a of iter) {
        res.push(f(a));
      }

      return res;
    });

    const filter = curry((f, iter) => {
      let res = [];
      for (const a of iter) {
        if (f(a)) res.push(a);
      }

      return res;
    });

    const reduce = curry((f, acc, iter) => {

      // 인자 2개만 받아도 동작하도록 구성
      if (!iter) {
        iter = acc[Symbol.iterator]();
        acc = iter.next().value;
      }

      for (const a of iter) {
        acc = f(acc, a);
      }

      return acc;
    });
  </script>
</head>
<body>
<div id="cart"></div>
<script>
  const products = [
    { name: '반팔티', price: 15000, quantity: 1 },
    { name: '긴팔티', price: 20000, quantity: 2 },
    { name: '핸드폰케이스', price: 15000, quantity: 3 },
    { name: '후드티', price: 30000, quantity: 4 },
    { name: '바지', price: 25000, quantity: 5 },
  ];

  const add = (a , b) => a + b;

  const total_quantity =
    pipe(
      map(p => p.quantity),
      reduce(add)
    );

  console.log(total_quantity(products));

  const total_price = pipe(
      map(p => p.price * p.quantity),
      reduce(add)
  );

  console.log(total_price(products));


  // 추상화
  const sum = curry((f, iter) => go(
      iter,
      map(f),
      reduce(add)
  ));

  console.log(sum(p => p.price * p.quantity, products));

  const total_quantity2 = sum(p => p.quantity);
  console.log(total_quantity2(products));

  const total_price2 = sum(p => p.price * p.quantity);
  console.log(total_price2(products));

  console.log(sum(u => u.age, [
    { age : 30 },
    { age : 20 },
    { age : 10 },
  ]));
</script>
</body>
</html>